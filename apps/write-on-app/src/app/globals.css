@import "tailwindcss";

:root {
  --background: #ffffff;
  --foreground: #171717;
  /* Z-index discipline tokens */
  --z-control-strip: 1000;
  --z-workspace: 0;
  
  /* Page size and padding constants */
  --page-width: 1200px;
  --page-height: 2200px;
  --page-padding-x: 40px;
  --page-padding-top: 40px;
  --page-padding-bottom: 40px;
  
  /* Virtual size calculation: page + padding */
  --virtual-width: calc(var(--page-width) + 2 * var(--page-padding-x));
  --virtual-height: calc(var(--page-height) + var(--page-padding-top) + var(--page-padding-bottom));
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

/* Reset default margins and ensure full-height root for layout stability */
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
}

body {
  background: var(--background);
  color: var(--foreground);
  font-family: Arial, Helvetica, sans-serif;
}

/* Next.js root height safety */
#__next, body > div:first-child {
  min-height: 100%;
}

/* Prevent scroll chaining during zoom handling */
.main-scroll {
  overscroll-behavior: none;
}

/* Input guardrails */
.workspace-root, .workspace-canvas-mount, canvas {
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  touch-action: none;
}

/* Phase-2: pin control strip and offset content */
.control-strip {
  /* Guardrail: freeze positioning to prevent regressions */
  position: fixed !important;  /* never overridden */
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  z-index: var(--z-control-strip, 1000) !important;
  width: 100%;
  display: flex;
  flex-direction: column;
  /* Provide a solid surface behind chrome to prevent content bleed-through */
  background-color: var(--chrome-bg, #ffffff);
  /* Optional subtle bottom border for separation */
  border-bottom: 1px solid var(--border-subtle, #e5e7eb);
}

/* Respect device safe areas on the top header area so measurements include the inset */
.chrome-header {
  padding-top: constant(safe-area-inset-top); /* iOS 11.2 legacy */
  padding-top: env(safe-area-inset-top);
  padding-left: env(safe-area-inset-left);
  padding-right: env(safe-area-inset-right);
}

/* Toolbars: fixed/sticky container handles pinning; ensure no transforms apply */
.app-header,
.top-toolbar,
.options-toolbar {
  transform: none !important;
  will-change: auto;
  contain: layout paint;
}

/* Top offset is applied in WorkspaceViewport using --h-stack;
   avoid duplicating here to prevent double spacing. */
.workspace-root {
  /* The viewport height varies on mobile browsers; prefer dynamic dvh with vh fallback */
  height: 100vh;
  height: 100dvh;
  /* Offset content by the fixed control strip height */
  padding-top: var(--control-strip-height, 200px); /* Increased default fallback */
  overflow-y: auto;
}

/* Viewport owns scrolling; inner scale layer owns zoom */
#workspace-viewport {
  overflow: auto;
  /* Center the scaled paper horizontally */
  display: flex;
  justify-content: center;
  align-items: flex-start; /* do not vertically center */
}

/* Scaled-size spacer and transform layer */
.workspace-scaler {
  position: relative;
  /* Spacer sized to UN-SCALED virtual size (page + padding) */
  width: var(--virtual-width, 1500px);
  height: var(--virtual-height, 2550px);
  /* Apply zoom only via transform on the scaler */
  transform: scale(var(--workspace-zoom, 1));
  transform-origin: top left;
}

/* Removed #workspace-scale-layer; scaling handled by engine/viewport */

.page-wrapper {
  width: var(--page-width);   /* basePageSize.w */
  height: var(--page-height);  /* basePageSize.h */
  position: absolute;
  /* Center page within virtual space using calc to account for padding */
  left: calc((var(--virtual-width) - var(--page-width)) / 2);
  top: calc((var(--virtual-height) - var(--page-height)) / 2);
  box-sizing: content-box; /* ensure padding doesn't shrink the paper */
}

/* Ensure indicator and strip pin to top and never transform */
.page-indicator,
.control-strip {
  position: sticky; /* control-strip is fixed via its rule; this is safe */
  top: 0;
  z-index: var(--z-control-strip, 1000);
  transform: none !important;
}

/* Ensure Excalidraw (or any engine) fills the page wrapper */
.excalidraw-container {
  position: absolute;
  inset: 0;
  width: 100% !important;
  height: 100% !important;
  max-width: none !important;
  max-height: none !important;
}

/* Force canvas CSS box to logical page size (via 100% of container) */
.excalidraw-container canvas {
  width: 100% !important;
  height: 100% !important;
}

/* Some Excalidraw builds apply inline sizes; override to keep CSS size stable */
.excalidraw .excalidraw__canvas,
.excalidraw .excalidraw__canvas canvas {
  width: 100% !important;
  height: 100% !important;
  max-width: none !important;
  max-height: none !important;
}

/* Phase 2: allow the scale layer to visually scale the entire page;
   do not apply counter-transforms on the canvas host so its logical
   size remains 1200x2200 CSS pixels regardless of zoom. */

/* Neutralize mobile/layout caps if applied by Excalidraw */
.excalidraw.excalidraw--mobile,
.excalidraw .layer-ui__wrapper,
.excalidraw .excalidraw__canvas {
  max-width: none !important;
  max-height: none !important;
}

/* Ensure mobile variant fills fully as well */
.excalidraw.excalidraw--mobile {
  width: 100% !important;
  height: 100% !important;
}

/* Avoid forcing transform/zoom on the engine canvas; let the engine manage its own internals */

/* Debug layout outlines (temporary aid) */
.debug-layout .workspace-viewport {
  outline: 1px solid #3b82f6; /* blue */
}
.debug-layout .workspace-scaler {
  outline: 1px solid #22c55e; /* green */
}
.debug-layout .workspace-canvas-mount {
  outline: 1px solid #fb923c; /* orange */
}

/* Workspace root composite vars: CSS owns computed heights */
[data-workspace-root] {
  /* default gaps and indicator height */
  --gap-header-top: 8px;
  --gap-top-opts: 8px;
  --gap-indicator-above: 8px;
  --gap-indicator-below: 0; /* no gap below PageIndicator */
  --h-indicator: 40px;
  /* computed stacks */
  --h-chrome: calc(var(--h-header) + var(--h-top) + var(--h-opts));
  --h-stack: calc(
    var(--h-chrome)
    + var(--gap-header-top)
    + var(--gap-top-opts)
    + var(--gap-indicator-above)
    + var(--h-indicator)
    + var(--gap-indicator-below)
  );
  /* Alias: control strip total height used by scroll container padding */
  --control-strip-height: var(--h-stack);
}

/* Workspace scaler sits directly below control strip with no extra gap */
.workspace-scaler {
  margin-top: 0;
}

/* Fix pointer events conflicts between top/left menu and Excalidraw canvas */
.FixedSideContainer_side_top {
  pointer-events: none;
  position: sticky;
  top: var(--h-stack);
  z-index: 50;
}

/* Re-enable pointer events for the inner controls */
.FixedSideContainer_side_top .App-menu_top,
.FixedSideContainer_side_top .App-menu_top * {
  pointer-events: auto;
}

/* Constrain left menu */
.App-menu_top__left {
  max-height: calc(100vh - var(--h-stack));
  overflow: auto;
  align-self: flex-start;
  background: transparent;
}

/* Ensure workspace layers have proper z-index */
.workspace-root,
.workspace-canvas-mount {
  position: relative;
  z-index: 0;
}

/* Excalidraw mount sizing - fills page */
.excalidraw-island-container {
  width: 100%;
  height: 100%;
}

/* Hide any remaining Excalidraw UI elements for pure drawing surface */
.excalidraw .App-toolbar,
.excalidraw .App-bottom-bar,
.excalidraw .App-menu,
.excalidraw .App-menu_bottom,
.excalidraw .App-menu_top,
.excalidraw .layer-ui__wrapper,
.excalidraw .FixedSideContainer,
.excalidraw .App-main__menu,
.excalidraw .welcome-screen,
.excalidraw .help-dialog,
.excalidraw .Stack,
.excalidraw .Stack_vertical,
.excalidraw .Stack_horizontal,
.excalidraw div[class*="Stack"],
.excalidraw .Island,
.excalidraw .ButtonSelect,
.excalidraw .ToolButton,
.excalidraw .Shape,
.excalidraw .panelColumn {
  display: none !important;
}

/* More aggressive hiding for any UI containers */
.excalidraw > div:not(.excalidraw__container):not(.canvas) {
  display: none !important;
}

/* Ensure only canvas and container are visible */
.excalidraw .excalidraw__container > *:not(.canvas):not(canvas) {
  display: none !important;
}

/* CRITICAL: Eliminate the giant Stack_vertical overlay and all Excalidraw UI */
.Stack.Stack_vertical,
div[class="Stack Stack_vertical"],
div[class*="Stack_vertical"],
div[class*="Stack "],
.excalidraw-island-container .Stack,
.excalidraw-island-container .Stack_vertical,
.excalidraw-island-container div[class*="Stack"],
.excalidraw .Stack,
.excalidraw .Stack_vertical,
.excalidraw div[class*="Stack"],
/* Target any UI overlay elements */
.excalidraw > div[class*="Stack"],
.excalidraw-wrapper > div[class*="Stack"],
excalidraw-island div[class*="Stack"],
/* Nuclear option: any div with Stack in class name */
div[class*="Stack"] {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  pointer-events: none !important;
  position: absolute !important;
  top: -9999px !important;
  left: -9999px !important;
  z-index: -1 !important;
}

/* NUCLEAR OPTION: Target the Web Component directly */
excalidraw-island::part(ui-overlay),
excalidraw-island * [class*="overlay"],
excalidraw-island * [class*="ui-"],
excalidraw-island * [class*="toolbar"],
excalidraw-island * [class*="menu"],
excalidraw-island * [class*="panel"],
excalidraw-island * [class*="footer"],
excalidraw-island * [class*="header"] {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  pointer-events: none !important;
}

/* Force the shadow DOM to hide UI elements */
excalidraw-island {
  --excalidraw-ui-visibility: hidden !important;
}

/* Ensure only canvas remains visible and fills container */
.excalidraw .excalidraw-canvas,
.excalidraw canvas {
  width: 100% !important;
  height: 100% !important;
  position: relative !important;
  z-index: 1 !important;
}
